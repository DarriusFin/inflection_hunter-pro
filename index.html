<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inflection Hunter Pro v6.0 │ Darrius FinTech Inc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
<style>
  :root{--bg:#0a0e17;--card:#161b22;--border:#30363d;--green:#00ff88;--red:#ff4757;--text:#e6edf3;--text2:#8b949e;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;background:radial-gradient(circle at top left,#1a1f2e,#0a0e17);}
  
  #topbar{height:64px;background:rgba(22,27,34,0.98);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;z-index:100;}
  #brand{display:flex;align-items:center;gap:18px;}
  #brandLogo{font-size:34px;font-weight:900;background:linear-gradient(90deg,#00ff88,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  #brandName{font-size:22px;font-weight:800;}
  #company{font-size:13px;color:var(--text2);}
  #status{background:rgba(0,255,136,0.15);color:var(--green);padding:8px 16px;border-radius:10px;font-size:13px;font-weight:600;}
  #copyright{font-size:13px;color:#fff;opacity:0.9;background:rgba(0,0,0,0.5);padding:6px 20px;border-radius:20px;}
  
  #main{display:flex;height:calc(100vh - 64px);}
  #chartArea{flex:1;position:relative;background:#0d1117;} /* 深空灰背景，不刺眼 */
  #watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-20deg);font-size:9rem;font-weight:900;opacity:0.08;color:var(--red);pointer-events:none;z-index:5;}
  
  #sidebar{width:390px;background:var(--card);border-left:1px solid var(--border);display:flex;flex-direction:column;}
  .panel{background:rgba(255,255,255,0.03);border-bottom:1px solid var(--border);padding:22px;}
  .panel h3{color:var(--green);font-size:16px;margin-bottom:16px;display:flex;align-items:center;gap:8px;}
  .panel h3::before{content:"◆";font-size:12px;}
  
  #signals{max-height:380px;overflow-y:auto;}
  .signal{padding:12px 16px;margin:8px 0;border-radius:12px;font-size:14px;animation:slideIn .4s;border-left:4px solid;}
  .buy{background:rgba(0,255,136,0.12);border-color:var(--green);}
  .sell{background:rgba(255,71,87,0.12);border-color:var(--red);}
  @keyframes slideIn{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:none}}
  
  .tf-buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
  .tf-btn{padding:9px 14px;background:rgba(255,255,255,0.08);border:1px solid var(--border);border-radius:10px;font-size:13px;cursor:pointer;transition:all .2s;}
  .tf-btn.active{background:var(--green);color:#000;border-color:var(--green);font-weight:bold;}
  
  select,input[type=checkbox],input[type=text]{width:100%;padding:12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:10px;color:var(--text);margin:8px 0;}
  
  .symbol-input{display:flex;gap:10px;margin:12px 0;}
  .symbol-input input{flex:1;}
  .symbol-input button{padding:12px 28px;background:var(--green);color:#000;border:none;border-radius:10px;cursor:pointer;font-weight:bold;font-size:14px;}
  
  /* 升级按钮彻底固定右下角 + 可点击 */
  #upgradeBtn{
    position:fixed !important;
    bottom:40px !important;
    right:40px !important;
    background:linear-gradient(135deg,#00ff88,#00d4ff);
    color:#000;
    padding:16px 36px !important;
    border-radius:50px;
    font-size:17px;
    font-weight:bold;
    cursor:pointer;
    z-index:9999999 !important;
    box-shadow:0 12px 40px rgba(0,255,136,0.6);
    transition:all .3s;
    pointer-events:auto !important;
  }
  #upgradeBtn:hover{transform:scale(1.1);}
  
  /* 支付弹窗 */
  #paywall{position:fixed;inset:0;background:rgba(0,0,0,0.97);backdrop-filter:blur(20px);z-index:999999;display:none;align-items:center;justify-content:center;overflow-y:auto;padding:60px 20px;}
  #paywall-content{max-width:1400px;width:100%;text-align:center;}
  #paywall h1{font-size:4.5rem;margin-bottom:20px;background:linear-gradient(90deg,#00ff88,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  #paywall .subtitle{font-size:1.6rem;color:#00ff88;margin:30px 0;}
  #paywall .desc{font-size:1.4rem;max-width:900px;margin:0 auto 60px;color:#ccc;}
  #paywall .cards{display:flex;gap:50px;justify-content:center;flex-wrap:wrap;align-items:stretch;}
  .card{background:rgba(255,255,255,0.06);border:1px solid var(--border);border-radius:24px;padding:40px 35px;width:340px;display:flex;flex-direction:column;justify-content:space-between;transition:all .4s;box-shadow:0 15px 50px rgba(0,0,0,0.6);}
  .card:hover{transform:translateY(-20px);border-color:var(--green);}
  .card.popular{border:3px solid var(--green);position:relative;}
  .card.popular::after{content:"BEST VALUE";position:absolute;top:-18px;left:50%;transform:translateX(-50%);background:var(--green);color:#000;padding:12px 40px;border-radius:30px;font-weight:bold;}
  .price{font-size:4.5rem;font-weight:bold;color:#fff;margin:25px 0;}
  .btn-pay{width:100%;padding:22px;margin-top:35px;border:none;border-radius:18px;font-size:1.5rem;font-weight:bold;cursor:pointer;background:linear-gradient(90deg,#00ff88,#00d4ff);color:#000;transition:all .3s;}
  .btn-pay:hover{transform:scale(1.05);}
  #closePay{position:absolute;top:40px;right:50px;font-size:48px;cursor:pointer;color:#fff;opacity:0.8;}
</style>
</head>
<body>

<div id="topbar">
  <div id="brand">
    <div id="brandLogo">Inflection Hunter</div>
    <div>
      <div id="brandName">Inflection Hunter Pro</div>
      <div id="company">Darrius FinTech Inc</div>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:20px;">
    <div id="status">Free Version · 60s Signal Delay</div>
    <div id="copyright">© 2025 Darrius FinTech Inc. All Rights Reserved.</div>
  </div>
</div>

<div id="main">
  <div id="chartArea">
    <div id="chartContainer"></div>
    <div id="watermark">FREE VERSION</div>
  </div>

  <div id="sidebar">
    <div class="panel">
      <h3>Symbol & Timeframe</h3>
      
      <div class="symbol-input">
        <input type="text" id="customSymbol" placeholder="Enter symbol, e.g., AAPL, TSLA, 0700.HK, BTC-USD..." value="BTC-USD">
        <button onclick="changeSymbol(document.getElementById('customSymbol').value.trim().toUpperCase())">Load</button>
      </div>

      <select id="symbol" onchange="changeSymbol(this.value)">
        <optgroup label="Crypto">
          <option value="BTC-USD">BTC/USD</option>
          <option value="ETH-USD">ETH/USD</option>
          <option value="SOL-USD">SOL/USD</option>
        </optgroup>
        <optgroup label="US Stocks">
          <option value="AAPL">AAPL Apple</option>
          <option value="TSLA">TSLA Tesla</option>
          <option value="NVDA">NVDA Nvidia</option>
          <option value="MSFT">MSFT Microsoft</option>
        </optgroup>
        <optgroup label="HK Stocks">
          <option value="0700.HK">0700.HK Tencent</option>
          <option value="9988.HK">9988.HK Alibaba</option>
        </optgroup>
      </select>

      <!-- 时间线：移除1min，增加4H、日、周、月、年 -->
      <div class="tf-buttons">
        <button class="tf-btn" data-tf="5">5min</button>
        <button class="tf-btn active" data-tf="15">15min</button>
        <button class="tf-btn" data-tf="60">1hour</button>
        <button class="tf-btn" data-tf="240">4hour</button>
        <button class="tf-btn" data-tf="1D">1day</button>
        <button class="tf-btn" data-tf="1W">1week</button>
        <button class="tf-btn" data-tf="1M">1month</button>
        <button class="tf-btn" data-tf="1Y">1year</button>
      </div>
    </div>

    <div class="panel">
      <h3>Live Signals</h3>
      <div id="signals">Loading real-time data...</div>
    </div>

    <div class="panel">
      <h3>Settings</h3>
      <label><input type="checkbox" id="showZigZag" checked> Show ZigZag Line</label><br><br>
      <label><input type="checkbox" id="showDarriusAI" checked> Show DarriusAI Trend Line</label><br><br>
      <label><input type="checkbox" id="sound" checked> Sound Alert (Pro only)</label>
    </div>

    <div class="panel" style="flex:1;text-align:center;padding-top:60px;">
      <p style="color:var(--text2);font-size:14px;line-height:2;">World's Leading Multi-Asset Inflection Detection<br>Exclusively developed by Darrius FinTech Inc</p>
    </div>
  </div>
</div>

<!-- 升级按钮 -->
<div id="upgradeBtn" onclick="document.getElementById('paywall').style.display='flex'">
  Upgrade to Pro → Real-time Signals
</div>

<!-- 支付弹窗 -->
<div id="paywall">
  <div id="closePay" onclick="this.parentElement.style.display='none'">×</div>
  <div id="paywall-content">
    <h1>Inflection Hunter Pro</h1>
    <p class="subtitle">Official Version by Darrius FinTech Inc</p>
    <p class="desc">Real-time precision signals · Remove delay & watermark · Voice + popup alerts · Lifetime updates</p>
    
    <div class="cards">
      <div class="card">
        <h3>Monthly</h3>
        <div class="price">$19.99</div>
        <p>Billed monthly<br>Cancel anytime</p>
        <button class="btn-pay" onclick="location.href='https://buy.stripe.com/cNi3cxdsk2fM6ia3Q8g7e02'">Choose Monthly</button>
      </div>
      <div class="card popular">
        <h3>Annual</h3>
        <div class="price">$99</div>
        <p><strong>Only $8.25/month</strong><br><mark>Save 59%</mark></p>
        <button class="btn-pay" onclick="location.href='https://buy.stripe.com/5kQ14p3RKf2y6iaeuMg7e01'">Annual Best Deal</button>
      </div>
      <div class="card">
        <h3>Lifetime</h3>
        <div class="price">$299</div>
        <p>One-time payment<br>Own forever</p>
        <button class="btn-pay" onclick="location.href='https://buy.stripe.com/7sY6oJfAs4nU8qi9asg7e00'">Buy Lifetime Access</button>
      </div>
    </div>
    <p style="margin-top:60px;color:#888;font-size:15px;">Refresh page after payment to unlock permanently · Secured by Stripe</p>
  </div>
</div>

<script>
const IS_PRO = localStorage.getItem('inflection_pro') === 'forever' || new Date(localStorage.getItem('inflection_expiry') || 0) > new Date();
if (IS_PRO) {
  document.getElementById('watermark').style.display = 'none';
  document.getElementById('status').innerHTML = 'Pro Activated · Real-time';
  document.getElementById('status').style.background = 'linear-gradient(90deg,#00ff88,#00d4ff)';
  document.getElementById('status').style.color = '#000';
  document.getElementById('upgradeBtn').style.display = 'none';
}

let chart, candleSeries, zzSeries, upSeries, dnSeries;
let tf = '15', symbol = 'BTC-USD';

function initChart() {
  chart = LightweightCharts.createChart(document.getElementById('chartContainer'), {
    width: document.getElementById('chartArea').clientWidth,
    height: document.getElementById('main').clientHeight,
    layout: { backgroundColor: '#0d1117', textColor: '#d1d4dc' },
    grid: { vertLines: { color: '#1a1f2e' }, horzLines: { color: '#1a1f2e' } },
    timeScale: { timeVisible: true, secondsVisible: true },
  });
  candleSeries = chart.addCandlestickSeries({ upColor:'#00ff88', downColor:'#ff4757', wickUpColor:'#00ff88', wickDownColor:'#ff4757' });
  zzSeries = chart.addLineSeries({ color:'#ffaa00', lineWidth:2 });
  upSeries = chart.addLineSeries({ color:'#ff1493', lineWidth:4 });
  dnSeries = chart.addLineSeries({ color:'#7fff00', lineWidth:4 });
}
initChart();

async function loadHistoricalData() {
  document.getElementById('signals').innerHTML = 'Loading real-time data...';
  try {
    let interval, outputsize;
    if (tf === '5') { interval = '5min'; outputsize = 'compact'; }
    else if (tf === '15') { interval = '15min'; outputsize = 'compact'; }
    else if (tf === '60') { interval = '60min'; outputsize = 'compact'; }
    else if (tf === '240') { interval = '60min'; outputsize = 'full'; } // 4H 用1H数据聚合
    else if (tf === '1D') { interval = 'daily'; outputsize = 'full'; }
    else if (tf === '1W') { interval = 'weekly'; outputsize = 'full'; }
    else if (tf === '1M') { interval = 'monthly'; outputsize = 'full'; }
    else if (tf === '1Y') { interval = 'daily'; outputsize = 'full'; } // 年线用日线数据
    
    const url = `https://www.alphavantage.co/query?function=TIME_SERIES_${interval.toUpperCase()}&symbol=${symbol}&apikey=SW01UC0FIU6LQ6HQ&outputsize=${outputsize}`;
    
    const resp = await fetch(url);
    const json = await resp.json();
    
    let seriesKey = `Time Series (${interval})`;
    let series = json[seriesKey];
    if (!series) {
      seriesKey = `Time Series (${interval.toUpperCase()})`;
      series = json[seriesKey];
    }
    if (!series) throw new Error('No data');
    
    const entries = Object.entries(series).slice(0, 500);
    const data = entries.map(([t, v]) => ({
      time: Math.floor(new Date(t).getTime() / 1000),
      open: parseFloat(v['1. open']),
      high: parseFloat(v['2. high']),
      low: parseFloat(v['3. low']),
      close: parseFloat(v['4. close'])
    })).reverse();
    
    candleSeries.setData(data);
    calculateDarriusAITrend(data);
    document.getElementById('signals').innerHTML = 'Live · Connected';
  } catch (e) {
    generateMockData();
    document.getElementById('signals').innerHTML = 'Demo Mode · Dynamic Chart';
  }
}
loadHistoricalData();

// DarriusAI Trend Line + B/S 拐点
function calculateDarriusAITrend(data) {
  if (data.length < 50) return;
  const period = 40;
  const p = Math.floor(Math.sqrt(period));
  
  const wma = (arr, idx, len) => {
    if (idx + len > arr.length) return arr[idx].close;
    let sum = 0, weightSum = 0;
    for (let i = 0; i < len; i++) {
      const weight = len - i;
      sum += arr[idx + i].close * weight;
      weightSum += weight;
    }
    return sum / weightSum;
  };
  
  const vect = [];
  for (let i = 0; i < data.length; i++) {
    vect[i] = 2 * wma(data, i, period/2) - wma(data, i, period);
  }
  
  const ext = [];
  for (let i = 0; i < data.length - p; i++) {
    let sum = 0, weightSum = 0;
    for (let j = 0; j < p; j++) {
      const weight = p - j;
      sum += vect[i + j] * weight;
      weightSum += weight;
    }
    ext[i] = sum / weightSum;
  }
  
  const upData = [], dnData = [];
  let trend = 1;
  for (let i = ext.length - 1; i >= 0; i--) {
    if (i < ext.length - 1) {
      if (ext[i] > ext[i+1]) trend = 1;
      if (ext[i] < ext[i+1]) trend = -1;
    }
    
    const time = data[i + p]?.time || data[i].time;
    
    if (trend > 0) {
      upData.push({ time, value: ext[i] });
      dnData.push({ time, value: NaN });
      if (i < ext.length - 2 && ext[i] > ext[i+1] && ext[i+1] <= ext[i+2]) {
        chart.addMarker({ time, position: 'belowBar', color: '#ff1493', shape: 'circle', text: 'B' });
      }
    } else {
      dnData.push({ time, value: ext[i] });
      upData.push({ time, value: NaN });
      if (i < ext.length - 2 && ext[i] < ext[i+1] && ext[i+1] >= ext[i+2]) {
        chart.addMarker({ time, position: 'aboveBar', color: '#ffff00', shape: 'circle', text: 'S' });
      }
    }
  }
  
  if (document.getElementById('showDarriusAI').checked) {
    upSeries.setData(upData.filter(d => !isNaN(d.value)));
    dnSeries.setData(dnData.filter(d => !isNaN(d.value)));
  }
}

function generateMockData() {
  const now = Math.floor(Date.now() / 1000);
  const base = symbol.includes('BTC') ? 91430 : symbol.includes('NVDA') ? 182 : symbol.includes('AAPL') ? 195 : 3400;
  let price = base;
  const data = [];
  for (let i = 499; i >= 0; i--) {
    const time = now - i * 60;
    price += (Math.random() - 0.5) * base * 0.002;
    const open = price;
    const close = price + (Math.random() - 0.5) * base * 0.001;
    const high = Math.max(open, close) + Math.random() * base * 0.0005;
    const low = Math.min(open, close) - Math.random() * base * 0.0005;
    data.push({ time, open, high, low, close });
  }
  candleSeries.setData(data);
  calculateDarriusAITrend(data);
}

function changeSymbol(sym) {
  symbol = sym.toUpperCase();
  document.getElementById('customSymbol').value = symbol;
  loadHistoricalData();
}

document.getElementById('showDarriusAI').onchange = function() {
  if (this.checked && candleSeries.data().length > 0) {
    calculateDarriusAITrend(candleSeries.data());
  } else {
    upSeries.setData([]);
    dnSeries.setData([]);
  }
};

document.querySelectorAll('.tf-btn').forEach(b => b.onclick = () => {
  document.querySelector('.tf-btn.active')?.classList.remove('active');
  b.classList.add('active');
  tf = b.dataset.tf;
  loadHistoricalData();
});

window.onresize = () => chart?.resize(document.getElementById('chartArea').clientWidth, document.getElementById('main').clientHeight);
</script>
</body>
</html>
