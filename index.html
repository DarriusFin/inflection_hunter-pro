<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>拐点猎手 · Inflection Hunter Pro │ Darrius FinTech Inc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Charts -->
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

<style>
:root{
  --bg:#0b0f17;
  --panel:#141a24;
  --border:#2a3244;
  --text:#e6edf3;
  --muted:#9aa4b2;
  --green:#00ff88;
  --red:#ff4757;
  --blue:#00d4ff;
  --yellow:#ffaa00;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top left,#182035,#0b0f17);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}

/* ---------- TOP BAR ---------- */
#topbar{
  height:64px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 24px;
  background:rgba(20,26,36,.95);
  border-bottom:1px solid var(--border);
}
#brand{
  display:flex;
  align-items:center;
  gap:14px;
}
#logo{
  font-size:26px;
  font-weight:900;
  background:linear-gradient(90deg,var(--green),var(--blue));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
#subtitle{
  font-size:13px;
  color:var(--muted);
}
#status{
  padding:6px 14px;
  border-radius:16px;
  font-size:13px;
  background:#1e2533;
}
#upgrade{
  margin-left:12px;
  padding:8px 18px;
  border-radius:20px;
  background:linear-gradient(90deg,var(--green),var(--blue));
  color:#000;
  font-weight:800;
  cursor:pointer;
}

/* ---------- MAIN LAYOUT ---------- */
#main{
  display:grid;
  grid-template-columns:320px 1fr 360px;
  height:calc(100vh - 64px);
}

/* ---------- PANELS ---------- */
.panel{
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:16px;
  overflow:auto;
}
.panel h3{
  margin:0 0 12px;
  font-size:15px;
  color:var(--green);
}

/* ---------- LEFT ---------- */
#pulse{
  display:flex;
  align-items:center;
  justify-content:center;
  height:160px;
}
#pulseCircle{
  width:120px;height:120px;
  border-radius:50%;
  border:10px solid var(--green);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  font-weight:800;
}
#pulseLabel{
  text-align:center;
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
}

.risk-box{
  margin-top:16px;
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
}
.risk-box div{margin:4px 0;font-size:13px}

/* ---------- CENTER ---------- */
#chartWrap{
  position:relative;
  height:100%;
}
#price{
  position:absolute;
  top:12px;left:12px;
  background:rgba(0,0,0,.6);
  padding:6px 12px;
  border-radius:12px;
  font-weight:700;
  z-index:10;
}

/* ---------- RIGHT ---------- */
select,input,button{
  width:100%;
  margin:6px 0;
  padding:8px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#0f1522;
  color:var(--text);
}
.signal{
  border-left:4px solid var(--green);
  padding:10px;
  margin:8px 0;
  background:#0f1522;
  border-radius:8px;
  font-size:13px;
}
.signal.sell{border-color:var(--red)}

.badge{
  font-size:12px;
  padding:4px 8px;
  border-radius:8px;
  background:#26304a;
  display:inline-block;
  margin-bottom:8px;
}

/* ---------- FOOT ---------- */
.footer{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:12px;
}
</style>
</head>

<body>

<div id="topbar">
  <div id="brand">
    <div id="logo">拐点猎手</div>
    <div>
      <div style="font-weight:700">Inflection Hunter Pro</div>
      <div id="subtitle">Darrius FinTech Inc</div>
    </div>
  </div>
  <div>
    <span id="status">Checking…</span>
    <span id="upgrade" onclick="startCheckout()">Start Trial</span>
  </div>
</div>

<div id="main">

  <!-- LEFT -->
  <div class="panel">
    <h3>Market Pulse</h3>
    <div id="pulse">
      <div id="pulseCircle">--</div>
    </div>
    <div id="pulseLabel">Loading…</div>

    <h3 style="margin-top:20px">Risk Copilot</h3>
    <div class="risk-box" id="riskBox">
      <div>Entry: --</div>
      <div>Stop: --</div>
      <div>Targets: --</div>
    </div>

    <div class="footer">
      拐点猎手 · 非投资建议
    </div>
  </div>

  <!-- CENTER -->
  <div id="chartWrap">
    <div id="price">--</div>
    <div id="chart" style="width:100%;height:100%"></div>
  </div>

  <!-- RIGHT -->
  <div class="panel">
    <h3>Symbol & Timeframe</h3>
    <select id="symbol">
      <option value="AAPL">AAPL</option>
      <option value="BTC-USD">BTC-USD</option>
      <option value="XAUUSD">XAUUSD</option>
    </select>
    <select id="tf">
      <option value="15">15m</option>
      <option value="60">1h</option>
      <option value="1D">1D</option>
    </select>
    <button onclick="reload()">Load</button>

    <h3 style="margin-top:16px">Live Signals</h3>
    <div id="signals">Loading…</div>

    <h3 style="margin-top:16px">Email Alerts <span class="badge">Pro</span></h3>
    <input id="alertEmail" placeholder="you@email.com"/>
    <button onclick="saveAlert()">Save Alert</button>

    <h3 style="margin-top:16px">Share</h3>
    <button onclick="share()">Copy Share Link</button>
  </div>

</div>

<script>
let chart = LightweightCharts.createChart(document.getElementById("chart"),{
  layout:{background:{color:"#0b0f17"},textColor:"#ccc"},
  grid:{vertLines:{color:"transparent"},horzLines:{color:"transparent"}}
});
let candle = chart.addCandlestickSeries();
let upLine = chart.addLineSeries({color:"#00ff88",lineWidth:2});
let dnLine = chart.addLineSeries({color:"#ff4757",lineWidth:2});

async function api(url,opts){const r=await fetch(url,opts);return r.json();}

async function reload(){
  const s=symbol.value, t=tf.value;
  const bars=await api(`/api/bars?symbol=${s}&tf=${t}`);
  if(!bars.ok){alert(bars.message);return;}
  candle.setData(bars.bars);
  price.innerText=bars.bars.at(-1).close.toFixed(2);

  const sig=await api(`/api/signals?symbol=${s}&tf=${t}`);
  signals.innerHTML="";
  if(sig.signals){
    sig.signals.forEach(x=>{
      const d=document.createElement("div");
      d.className="signal "+(x.side==="S"?"sell":"");
      d.innerText=`${x.side} @ ${x.signal_price}`;
      signals.appendChild(d);
    });
  }
  if(sig.trendLines){
    upLine.setData(sig.trendLines.up||[]);
    dnLine.setData(sig.trendLines.dn||[]);
  }
}
reload();

async function startCheckout(){
  const r=await api("/api/stripe/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:"monthly"})});
  if(r.url) location.href=r.url;
}

async function saveAlert(){
  const email=alertEmail.value;
  const s=symbol.value, t=tf.value;
  const r=await api("/api/alerts/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,symbol:s,tf:t,sides:"B,S",enabled:true})});
  alert(r.ok?"Saved":"Failed");
}

async function share(){
  const r=await api("/api/share",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:{symbol:symbol.value,tf:tf.value}})});
  navigator.clipboard.writeText(r.url);
  alert("Share link copied");
}
</script>

</body>
</html>
