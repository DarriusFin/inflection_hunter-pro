<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inflection Hunter Pro v6.0 │ Darrius FinTech Inc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
<style>
  :root{--bg:#0a0e17;--card:#161b22;--border:#30363d;--green:#00ff88;--red:#ff4757;--text:#e6edf3;--text2:#8b949e;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;background:radial-gradient(circle at top left,#1a1f2e,#0a0e17);}
  #topbar{height:64px;background:rgba(22,27,34,0.98);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;z-index:100;}
  #brand{display:flex;align-items:center;gap:18px;}
  #brandLogo{font-size:34px;font-weight:900;background:linear-gradient(90deg,#00ff88,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  #brandName{font-size:22px;font-weight:800;}
  #company{font-size:13px;color:var(--text2);margin-top:2px;}
  #status{background:rgba(0,255,136,0.15);color:var(--green);padding:8px 16px;border-radius:10px;font-size:13px;font-weight:600;}
  #main{display:flex;height:calc(100vh - 64px - 40px);}
  #chartArea{flex:1;position:relative;background:#000;}
  #watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-20deg);font-size:9rem;font-weight:900;opacity:0.08;color:var(--red);pointer-events:none;z-index:5;}
  #sidebar{width:390px;background:var(--card);border-left:1px solid var(--border);display:flex;flex-direction:column;}
  .panel{background:rgba(255,255,255,0.03);border-bottom:1px solid var(--border);padding:22px;}
  .panel h3{color:var(--green);font-size:16px;margin-bottom:16px;display:flex;align-items:center;gap:8px;}
  .panel h3::before{content:"◆";font-size:12px;}
  #signals{max-height:380px;overflow-y:auto;}
  .signal{padding:12px 16px;margin:8px 0;border-radius:12px;font-size:14px;animation:slideIn .4s;border-left:4px solid;}
  .buy{background:rgba(0,255,136,0.12);border-color:var(--green);}
  .sell{background:rgba(255,71,87,0.12);border-color:var(--red);}
  @keyframes slideIn{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
  .tf-buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
  .tf-btn{padding:9px 16px;background:rgba(255,255,255,0.08);border:1px solid var(--border);border-radius:10px;font-size:13px;cursor:pointer;transition:all .2s;}
  .tf-btn.active{background:var(--green);color:#000;border-color:var(--green);font-weight:bold;}
  select,input[type=checkbox]{width:100%;padding:12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:10px;color:var(--text);margin:8px 0;}
  #paywall{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.97);backdrop-filter:blur(20px);z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column;padding:20px;text-align:center;}
  #paywall h1{font-size:3.8rem;margin-bottom:20px;background:linear-gradient(90deg,#00ff88,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  #paywall .cards{display:flex;gap:24px;flex-wrap:wrap;justify-content:center;margin:40px 0;}
  .card{background:rgba(255,255,255,0.06);border:1px solid var(--border);border-radius:18px;padding:34px 28px;width:290px;transition:all .3s;}
  .card:hover{transform:translateY(-12px);border-color:var(--green);}
  .card.popular{border:2px solid var(--green);position:relative;}
  .card.popular::after{content:"BEST VALUE";position:absolute;top:-14px;background:var(--green);color:#000;padding:8px 24px;border-radius:30px;font-size:13px;font-weight:bold;}
  .price{font-size:3.4rem;font-weight:bold;margin:16px 0;}
  .btn-pay{width:100%;padding:18px;margin-top:24px;border:none;border-radius:14px;font-size:1.2rem;font-weight:bold;cursor:pointer;background:linear-gradient(90deg,#00ff88,#00d4ff);color:#000;transition:all .3s;}
  .btn-pay:hover{transform:scale(1.05);box-shadow:0 10px 30px rgba(0,255,136,0.4);}
  #closePay{position:absolute;top:20px;right:30px;font-size:3rem;cursor:pointer;opacity:0.7;}
  #upgradeBtn{position:fixed;bottom:50px;right:50px;background:linear-gradient(135deg,#00ff88,#00d4ff);color:#000;padding:16px 36px;border-radius:50px;font-size:18px;font-weight:bold;cursor:pointer;z-index:100;box-shadow:0 8px 30px rgba(0,255,136,0.4);transition:all .3s;}
  #upgradeBtn:hover{transform:scale(1.08);}
  footer{position:fixed;bottom:0;left:0;width:100%;height:40px;background:rgba(22,27,34,0.98);display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;z-index:100;backdrop-filter:blur(10px);}
</style>
</head>
<body>

<div id="topbar">
  <div id="brand">
    <div id="brandLogo">Inflection Hunter</div>
    <div>
      <div id="brandName">Inflection Hunter Pro</div>
      <div id="company">Darrius FinTech Inc</div>
    </div>
  </div>
  <div id="status">Free Version · 60s Signal Delay</div>
</div>

<div id="main">
  <div id="chartArea">
    <div id="chartContainer"></div>
    <div id="watermark">FREE VERSION</div>
  </div>

  <div id="sidebar">
    <div class="panel">
      <h3>Symbol & Timeframe</h3>
      <select id="symbol">
        <option value="BTCUSDT">BTC/USDT</option>
        <option value="ETHUSDT">ETH/USDT</option>
        <option value="SOLUSDT">SOL/USDT</option>
        <option value="BNBUSDT">BNB/USDT</option>
      </select>
      <div class="tf-buttons">
        <button class="tf-btn active" data-tf="1m">1min</button>
        <button class="tf-btn" data-tf="5m">5min</button>
        <button class="tf-btn" data-tf="15m">15min</button>
        <button class="tf-btn" data-tf="1h">1hour</button>
      </div>
    </div>

    <div class="panel">
      <h3>Live Signals</h3>
      <div id="signals">Connecting...</div>
    </div>

    <div class="panel">
      <h3>Settings</h3>
      <label><input type="checkbox" id="showZigZag" checked> Show ZigZag Line</label><br><br>
      <label><input type="checkbox" id="sound" checked> Sound Alert (Pro only)</label>
    </div>

    <div class="panel" style="flex:1;text-align:center;padding-top:50px;">
      <p style="color:var(--text2);font-size:14px;line-height:2;">World's Leading On-Chain Inflection Detection<br>Exclusively developed by Darrius FinTech Inc</p>
    </div>
  </div>
</div>

<!-- 右下角升级按钮 -->
<div id="upgradeBtn" onclick="document.getElementById('paywall').style.display='flex'">
  Upgrade to Pro → Real-time Signals
</div>

<!-- 支付弹窗 -->
<div id="paywall">
  <div id="closePay" onclick="this.parentElement.style.display='none'">×</div>
  <h1>Inflection Hunter Pro</h1>
  <p style="font-size:1.5rem;margin:30px 0;max-width:700px;color:#00ff88;">Official Version by Darrius FinTech Inc</p>
  <p style="font-size:1.3rem;margin:20px 0;max-width:700px;">Real-time precision signals · Remove delay & watermark · Voice popup alerts · Lifetime updates</p>
  <div class="cards">
    <div class="card">
      <h3 style="font-size:1.6rem;margin-bottom:10px;">Monthly</h3>
      <div class="price">$19.99</div>
      <p style="color:#aaa;margin:15px 0;">Billed monthly<br>Cancel anytime</p>
      <button class="btn-pay" onclick="location.href='https://buy.stripe.com/cNi3cxdsk2fM6ia3Q8g7e02'">Choose Monthly</button>
    </div>
    <div class="card popular">
      <h3 style="font-size:1.6rem;margin-bottom:10px;">Annual</h3>
      <div class="price">$99</div>
      <p style="color:#aaa;margin:15px 0;"><strong>Only $8.25/month</strong><br><mark style="background:#00ff8822;color:var(--green);">Save 59%</mark></p>
      <button class="btn-pay" onclick="location.href='https://buy.stripe.com/5kQ14p3RKf2y6iaeuMg7e01'">Annual Best Deal</button>
    </div>
    <div class="card">
      <h3 style="font-size:1.6rem;margin-bottom:10px;">Lifetime</h3>
      <div class="price">$299</div>
      <p style="color:#aaa;margin:15px 0;">One-time payment<br>Own forever · All future updates</p>
      <button class="btn-pay" onclick="location.href='https://buy.stripe.com/7sY6oJfAs4nU8qi9asg7e00'">Buy Lifetime Access</button>
    </div>
  </div>
  <p style="margin-top:40px;color:#888;">Refresh page after payment to unlock permanently · Secured by Stripe</p>
</div>

<!-- 底部版权声明 -->
<footer>
  © 2025 Darrius FinTech Inc. All Rights Reserved.
</footer>

<script>
const { DateTime } = luxon;
const IS_PRO = localStorage.getItem('inflection_pro') === 'forever' || new Date(localStorage.getItem('inflection_expiry') || 0) > new Date();

if (IS_PRO) {
  document.getElementById('watermark').style.display = 'none';
  document.getElementById('status').innerHTML = 'Pro Activated · Real-time';
  document.getElementById('status').style.background = 'linear-gradient(90deg,#00ff88,#00d4ff)';
  document.getElementById('status').style.color = '#000';
  document.getElementById('upgradeBtn').style.display = 'none';
} else {
  setInterval(() => { if (!IS_PRO) document.getElementById('paywall').style.display = 'flex'; }, 240000);
}

let chart, candleSeries, zzSeries;
let tf = '1m', symbol = 'BTCUSDT', ws;
const TF_SEC = { '1m':60, '5m':300, '15m':900, '1h':3600 };

function initChart() {
  chart = LightweightCharts.createChart(document.getElementById('chartContainer'), {
    width: document.getElementById('chartArea').clientWidth,
    height: document.getElementById('main').clientHeight,
    layout: { backgroundColor: '#000', textColor: '#d1d4dc' },
    grid: { vertLines: { color: '#1a1f2e' }, horzLines: { color: '#1a1f2e' } },
    timeScale: { timeVisible: true, secondsVisible: true },
  });
  candleSeries = chart.addCandlestickSeries({ upColor:'#00ff88', downColor:'#ff4757', wickUpColor:'#00ff88', wickDownColor:'#ff4757' });
  zzSeries = chart.addLineSeries({ color:'#ffaa00', lineWidth:2 });
}
initChart();

// 主数据加载函数（优先 Binance + 代理 → 失败则用高质量模拟数据）
async function loadHistoricalData() {
  document.getElementById('signals').innerHTML = 'Loading historical data...';
  try {
    // 使用免费公共代理解决 CORS
    const proxy = 'https://api.allorigins.win/raw?url=';
    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${tf}&limit=500`;
    const resp = await fetch(proxy + encodeURIComponent(url));
    if (!resp.ok) throw new Error('Network error');
    const data = await resp.json();
    const cdata = data.map(d => ({
      time: d[0]/1000,
      open: +d[1],
      high: +d[2],
      low: +d[3],
      close: +d[4]
    }));
    candleSeries.setData(cdata);
    document.getElementById('signals').innerHTML = 'Live · Connected';
  } catch (e) {
    console.log('Binance API failed, switching to demo mode');
    generateHighQualityMockData();
    document.getElementById('signals').innerHTML = 'Demo Mode · Dynamic Chart';
  }
}
loadHistoricalData();

// 高质量模拟数据（保证打开即有专业动态K线）
function generateHighQualityMockData() {
  const now = Math.floor(Date.now() / 1000);
  const basePrice = symbol.includes('BTC') ? 67000 : symbol.includes('ETH') ? 3400 : 180;
  let price = basePrice;
  const data = [];
  for (let i = 499; i >= 0; i--) {
    const time = now - i * (tf === '1m' ? 60 : tf === '5m' ? 300 : tf === '15m' ? 900 : 3600);
    const change = (Math.random() - 0.5) * (basePrice * 0.003);
    price += change;
    const open = price;
    const close = price + (Math.random() - 0.5) * (basePrice * 0.001);
    const high = Math.max(open, close) + Math.random() * (basePrice * 0.0005);
    const low = Math.min(open, close) - Math.random() * (basePrice * 0.0005);
    data.push({ time, open, high, low, close });
  }
  candleSeries.setData(data.reverse());
}

// WebSocket 实时更新（Binance官方，带重连）
function connect() {
  if (ws) ws.close();
  ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${symbol.toLowerCase()}@kline_${tf}`);
  ws.onmessage = e => {
    try {
      const msg = JSON.parse(e.data);
      if (!msg.data?.k?.x) return;
      const k = msg.data.k;
      const candle = { time: Math.floor(k.t/1000), open: +k.o, high: +k.h, low: +k.l, close: +k.c };
      candleSeries.update(candle);
      if (IS_PRO) processCandle(candle);
      else setTimeout(() => processCandle(candle), 60000);
    } catch (err) {}
  };
  ws.onclose = () => setTimeout(connect, 3000);
  ws.onerror = () => setTimeout(connect, 5000);
}
connect();

// 信号处理函数（保持不变）
function processCandle(latest) {
  const data = candleSeries.data().slice(-100);
  if (data.length < 30) return;
  const zz = calcZigZag(data, 0.004);
  document.getElementById('showZigZag').checked ? zzSeries.setData(zz) : zzSeries.setData([]);
  const fractals = findFractals(data);
  if (zz.length >= 2) {
    const last = zz[zz.length-1], prev = zz[zz.length-2];
    const confirm = fractals.slice(-10).some(f => Math.abs(f.time - last.time) <= TF_SEC[tf]*3 && ((prev.value > last.value && f.type === 'bottom') || (prev.value < last.value && f.type === 'top')));
    if (confirm && Math.abs(last.time - latest.time) < TF_SEC[tf]*2) addSignal(prev.value > last.value ? 'buy' : 'sell', last.value, last.time);
  }
}

function calcZigZag(data, dev=0.004) {
  const points = []; let dir=0, extreme=data[0];
  for (let i=1; i<data.length; i++) {
    const c = data[i];
    if (dir >= 0) { if (c.high > extreme.high) extreme=c;
      else if ((extreme.high-c.low)/extreme.high >= dev) { points.push({time:extreme.time,value:extreme.high}); dir=-1; extreme=c; }
    } else { if (c.low < extreme.low) extreme=c;
      else if ((c.high-extreme.low)/extreme.low >= dev) { points.push({time:extreme.time,value:extreme.low}); dir=1; extreme=c; }
    }
  }
  if (extreme) points.push(dir>0 ? {time:extreme.time,value:extreme.high} : {time:extreme.time,value:extreme.low});
  return points;
}

function findFractals(data) {
  const f = [];
  for (let i=2; i<data.length-2; i++) {
    const c = data[i];
    if (data[i-2].high < c.high && data[i-1].high < c.high && data[i+1].high < c.high && data[i+2].high < c.high) f.push({time:c.time,value:c.high,type:'top'});
    if (data[i-2].low > c.low && data[i-1].low > c.low && data[i+1].low > c.low && data[i+2].low > c.low) f.push({time:c.time,value:c.low,type:'bottom'});
  }
  return f;
}

function addSignal(type, price, time) {
  const dt = DateTime.fromSeconds(time).toFormat('MM-dd HH:mm:ss');
  const html = `<div class="signal ${type}">Signal ${dt} <strong>${type==='buy'?'LONG':'SHORT'}</strong> @ ${price.toFixed(2)}</div>`;
  const s = document.getElementById('signals');
  s.insertAdjacentHTML('afterbegin', html);
  if (s.children.length > 20) s.removeChild(s.lastChild);
  if (IS_PRO && document.getElementById('sound').checked) {
    speechSynthesis.speak(new SpeechSynthesisUtterance(type==='buy'?'Long signal':'Short signal'));
    alert(`Darrius FinTech · Inflection Hunter Pro\n${type==='buy'?'LONG SIGNAL':'SHORT SIGNAL'}\nPrice: ${price.toFixed(2)}`);
  }
}

document.querySelectorAll('.tf-btn').forEach(b=>b.onclick=()=>{ document.querySelector('.tf-btn.active').classList.remove('active'); b.classList.add('active'); tf = b.dataset.tf; loadHistoricalData(); connect(); });
document.getElementById('symbol').onchange=e=>{ symbol = e.target.value; loadHistoricalData(); connect(); };
document.getElementById('showZigZag').onchange=()=>{ if(candleSeries.data().length) processCandle(candleSeries.data().slice(-1)[0]); };

window.onresize = () => chart?.resize(document.getElementById('chartArea').clientWidth, document.getElementById('main').clientHeight);
</script>
</body>
</html>
